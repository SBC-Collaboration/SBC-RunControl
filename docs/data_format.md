# Run Control Data Format
This documentation contains information for the data structures of different saved files by the Run Control software and different modules.

## Configuration file
The master configuration file is saved in `.json` format. The data structure is:
- `general`: General configuration for the run control software. This includes paths that the software uses in 
  normal operation. This information generally doesn't change across runs and different days.
  - `config_path` (`str`): Path to the master config file.
  - `log_path` (`str`): Path to the log file.
  - `data_dir` (`str`): Main directory where all of the data is saved.
  - `max_ev_time` (`int`, s): Max time an event can last. After the maximum is reached, A software trigger is sent 
    from run control.
  - `max_num_evs` (`int`): Max number of events that a run can have. If the max number is reached, then the run will 
    end, instead of starting a new event.
- `scint`
  - `amp1`
    - `enabled` (`bool`)
    - `ip_addr` (`str`)
    - `bias` (`float`, V)
    - `qp` (`float`, V)
  - `caen`
    - `model` (`str`)
    - `port` (`int`)
    - `connection` (`str`)
    - `evs_per_read` (`int`)
    - `rec_length` (`int`)
    - `post_trig` (`int`)
    - `trig_in` (`bool`)
    - `decimation` (`int`)
    - `overlap` (`bool`)
    - `polarity` (`str`)
    - `io_level` (`str`)
    - `ext_trig` (`str`)
    - `sw_trig` (`str`)
  - `caen_g0`, `caen_g1`, `caen_g2`, `caen_g3`
    - `enabled` (`bool`)
    - `thresdhold` (`int`)
    - `trig_mask` (`bool`, 8)
    - `acq_mask` (`bool`, 8)
    - `offsets` (`int`, 8)
- `acous`
  - `general`
    - `sample_rate` (`str`)
    - `pre_trig_len` (`int`)
    - `post_trig_len` (`int`)
    - `trig_timeout` (`int`)
    - `trig_delay` (`int`)
  - `per_channel`
    - `ch1`, `ch2`, `ch3`, `ch4`, `ch5`, `ch6`, `ch7`, `ch8`
      - `enabled` (`bool`)
      - `range` (`int`)
      - `offset` (`int`)
      - `trig` (`bool`)
      - `polarity` (`str`)
      - `threshold` (`int`)
- `cam`
  - `cam1`, `cam2`, `cam3`
    - `enabled` (`bool`): Whether this camera is enabled. If not, this camera will be skipped
    - `rc_config_path`: Path of config file in the run control system.
    - `config_path` (`str`): Path of the config file in camera's raspberry pi system.
    - `data_path` (`str`): Data Path for the current event on the camera pi (mounted directory). For the main config file, this will be the mounted directory of the master data file. For the config file saved on camera for each event, it will be that path joined with run and event id.
    - `ip_addr` (`str`)
    - `mode` (`int`)
    - `trig_wait` (`float`)
    - `exposure` (`int`)
    - `buffer_len` (`int`)
    - `post_trig` (`int`)
    - `adc_threshold` (`int`)
    - `pix_threshold` (`int`)
    - `image_format` (`str`)
    - `date_format` (`str`)
    - `state_comm_pin` (`int`)
    - `trig_en_pin` (`int`)
    - `trig_latch_pin` (`int`)
    - `state_pin` (`int`)
    - `trig_pin` (`int`)
- `dio`
  - `arduinos`
    - `trigger`
      - `port` (`str`)
      - `sketch` (`str`)
    - `clock`
      - `port` (`str`)
      - `sketch` (`str`)
    - `position`
      - `port` (`str`)
      - `sketch` (`str`)

## Run data
The run data is saved in the `RunData` tables in the slow control SQL database. There is one line per run.
- `ID` (`BIGINT UNSIGNED`, `NOT NULL`, `PRIMARY KEY`, `AUTO-INCREMENT`): Auto-generated unique integer ID.
- `run_ID` (`VARCHAR(100)`, `NOT NULL`, `UNIQUE KEY`): Run ID generated by run control software, like "20240101_0".
- `num_event` (`INT UNSIGNED`, `NOT NULL`): Number of events in the run.
- `run_livetime` (`TIME(3)`, `NOT NULL`): Total livetime of the run, with ms precision.
- `comment` (`TEXT`): Any comments entered by the user during the run.
- `active_datastream` (`SET('imaging', 'scintillation', 'acoustics')`, `NOT NULL`): A list of active data streams for the run. It can have zero, one, or multiple entries, from the predetermined list. If it has zero elements, it is saved as an empty string, and not NULL.
- `pset_mode` (`ENUM('random', 'sequential')`, `NOT NULL`): Mode of pressure setpoint in this run. If `random`, then run control will choose randomly from the list. If `sequential`, then run control will cycle through the pressure setpoints in the list in order.
- `pset` (`FLOAT`, `NOT NULL`): Pressure set point of the run. If the run is doing pressure ramping, then the higher setpoint of the ramp
- `pset_hi` (`FLOAT`): Null if not using a pressure ramping. Lower pressure setpoint if using ramping.
- `start_time` (`TIMESTAMP(3)`, `NOT NULL`): UTC timestamp of when the run starts, with ms precision
- `end_time` (`TIMESTAMP(3)`, `NOT NULL`): UTC timestamp of when the run ends, with ms precision
- `source1_ID` (`VARCHAR(100)`): Name of source 1
- `source1_location` (`VARCHAR(100)`): Location of source 1
- `source2_ID` (`VARCHAR(100)`): Name of source 2
- `source2_location` (`VARCHAR(100)`): Location of source 2
- `source3_ID` (`VARCHAR(100)`): Name of source 3
- `source3_location` (`VARCHAR(100)`): Location of source 3
- More columns will be added when analysis module is running, like the last data reduction version performed and the 
  date, etc.

## Event data
This data is saved in the SBC binary format using `SBCBinaryFormat` library. The data structure is:
- `ev_number` (`uint32`, 3): A list of date, run number, and event number of current event. For example, for Run 
  20240101_0 Event 0, this list would be `[20240101, 0, 0]`.
- `ev_livetime` (`uint64`): Event livetime in milliseconds. This is the time from when all modules are ready to 
  when a trigger is received by the run control.
- `run_livetime` (`uint64`): Run livetime in milliseconds. This is the sum of the current and all previous events.
- `pset` (`float`): Pressure setpoint for this event. In case of pressure ramping or random sampling, the pressure setpoint could be different for each event. 
- `trigger_source` (`uint8`): Trigger source encoded in number. The list is:
  - `0`: Camera 1 motion detection;
  - `1`: Camera 2 motion detection;
  - `2`: Camera 3 motion detection;
  - `3`: Run control software trigger;
  - `4`: Run control timeout trigger;
  - `5`: PLC trigger, see PLC data for detail;
  - `6`: Kulite Ar trigger, high resolution trigger directly from Kulite (doesn't exist yet);
  - `7`: Kulite CF4 trigger, high resolution trigger directly from Kulite (doesn't exist yet);
  - `8`: External button manual trigger (doesn't exist yet);
  - `9`: Unknown.
